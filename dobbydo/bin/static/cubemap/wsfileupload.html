<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Insert title here</title>

	<script src="/js/angular-1.6.5.min.js"></script>
	<script src="/js/angular-route-1.6.5.min.js"></script>
	<script src="/js/jquery-3.2.1.min.js"></script>

<script type="text/javascript">
        var ws = null;
   
        function connector(){
            var url = "ws://localhost:8888/upload";
            ws = new WebSocket(url);
            ws.binaryType="arraybuffer";

            ws.onopen=function(){
                alert("연결 완료");
            };
            
            ws.onmessage = function(e){
                alert(e.msg);
            };
            
            ws.onclose = function() {
                alert("연결 종료");
            };
            ws.onerror = function(e) {
                alert(e.msg);
            }
        }    
        
        function sendFile(){
            var file = document.getElementById('file').files[0];
            ws.send('filename:'+file.name);
            alert('test');
            
            var reader = new FileReader();
            var rawData = new ArrayBuffer();            

            reader.loadend = function() {

            }
            
            reader.onload = function(e) {
                rawData = e.target.result;
                ws.send(rawData);
                alert("파일 전송이 완료 되었습니다.")
                ws.send('end');
            }

            reader.readAsArrayBuffer(file);
        }

        /*
        function addEvent(){
            document.getElementById("connect").addEventListener("click", connector, false);
            document.getElementById("send").addEventListener("click", sendFile, false);
        }
        window.addEventListener("load", addEvent, false);
        */
    </script>
</head>
<body ng-app="myApp4">		
<div>
<a href="./wsfileupload.html">WSFileUpload</a>
<a href="./cubemap.html">CubeMap</a>
<a href="./cammapping.html">CamMapping</a>
</div>
<div>

    <input id="file" type="file" >
    <input id="connect" type="button" value="connect" onclick="connector()">
    <input id="send" type="button" value="send" onclick="sendFile()">
    
</div>
</body>
</html>