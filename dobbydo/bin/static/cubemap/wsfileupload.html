<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Insert title here</title>

	<script src="/js/angular-1.6.5.min.js"></script>
	<script src="/js/angular-route-1.6.5.min.js"></script>
	<script src="/js/jquery-3.2.1.min.js"></script>

<script type="text/javascript">
        var ws = null;
   
        function connector(){
            var url = "ws://localhost:8888/bigfileupload";
            ws = new WebSocket(url);
            ws.binaryType="arraybuffer";

            ws.onopen = function(){
                alert("Connection Open");
            };
            ws.onmessage = function(e){
                alert(e.msg);
            };
            ws.onclose = function() {
                alert("Connection Close");
            };
            ws.onerror = function(e) {
                alert(e.msg);
            }
        }    
        
        
        
        function sendFile(){
            var file = document.getElementById('file').files[0];
            //send filename Text Message For Text Handler
            ws.send('filename:'+file.name);
            alert('File Transfer Start');
            
            var reader = new FileReader();     
            var arrbuf = new ArrayBuffer();

			reader.onload = function(e) {
            	if(reader.readyState == FileReader.DONE) {
            		arrbuf = reader.result;   
            		var fStart ;
            		var fEnd ;
            		var tti = parseInt(arrbuf.byteLength/1024);
            		for (var i = 0; i < tti+1 ; i++) {
            			fStart = i * 1024;
            			fEnd = (i+1) * 1024;
            			if(tti != i){
            				ws.send(arrbuf.slice(fStart, fEnd)); 
            			} else if(tti == i){
            				ws.send(arrbuf.slice(fStart, arrbuf.byteLength) ); 
            			}
            		}
	            	ws.send('end');
	            	alert('end!');
            	}
            }
			
            reader.readAsArrayBuffer(file);
        }
    </script>
</head>
<body ng-app="myApp4">		
<div>
<a href="./wsfileupload.html">WSFileUpload</a>
<a href="./cubemap.html">CubeMap</a>
<a href="./cammapping.html">CamMapping</a>
</div>
<div>
    <input id="file" type="file" >
    <input id="connect" type="button" value="connect" onclick="connector()">
    <input id="send" type="button" value="send" onclick="sendFile()">
</div>
</body>
</html>